{"ast":null,"code":"var _ = require('lodash'),\n  sdk = require('postman-collection'),\n  /**\n   * @const\n   * @type {string}\n   */\n  FUNCTION = 'function',\n  SAFE_CONTEXT_PROPERTIES = ['replayState', 'coords'];\n\n/**\n * Creates a context object to be used with `http-request.command` extension.\n *\n * @function createItemContext\n *\n * @param {Object} payload -\n * @param {Item} payload.item -\n * @param {Object} [payload.coords] -\n * @param {Object} [defaults] -\n * @param {Object} [defaults.replayState] -\n * @param {Object} [defaults.coords] -\n *\n * @returns {ItemContext}\n */\nmodule.exports = function (payload, defaults) {\n  // extract properties from defaults that can/should be reused in new context\n  var context = defaults ? _.pick(defaults, SAFE_CONTEXT_PROPERTIES) : {};\n\n  // set cursor to context\n  !context.coords && (context.coords = payload.coords);\n\n  // save original item for reference\n  context.originalItem = payload.item;\n\n  // we clone item from the payload, so that we can make any changes we need there, without mutating the\n  // collection\n  context.item = new sdk.Item(payload.item.toJSON());\n\n  // get a reference to the Auth instance from the item, so changes are synced back\n  context.auth = context.originalItem.getAuth();\n\n  // Make sure run is not errored out if older version of collection SDK is used.\n  // @todo remove this safety check in the next release\n  if (typeof context.originalItem.getProtocolProfileBehaviorResolved === FUNCTION) {\n    // get protocolProfileBehavior for the item, also inherited from parent\n    context.protocolProfileBehavior = context.originalItem.getProtocolProfileBehaviorResolved();\n  } else {\n    // get protocolProfileBehavior for the item\n    context.protocolProfileBehavior = context.originalItem.protocolProfileBehavior;\n  }\n\n  /**\n   * @typedef {Object} ItemContext\n   * @property {Object} coords - current cursor\n   * @property {Item} originalItem - reference to the item in the collection\n   * @property {Item} item -  Holds a copy of the item given in the payload, so that it can be manipulated\n   * as necessary\n   * @property {RequestAuthBase|undefined} auth - If present, is the instance of Auth in the collection, which\n   * is changed as necessary using intermediate requests, etc.\n   * @property {ReplayState} replayState - has context on number of replays(if any) for this request\n   */\n  return context;\n};","map":{"version":3,"names":["_","require","sdk","FUNCTION","SAFE_CONTEXT_PROPERTIES","module","exports","payload","defaults","context","pick","coords","originalItem","item","Item","toJSON","auth","getAuth","getProtocolProfileBehaviorResolved","protocolProfileBehavior"],"sources":["/Users/Qusai.Qishta/node_modules/postman-runtime/lib/runner/create-item-context.js"],"sourcesContent":["var _ = require('lodash'),\n    sdk = require('postman-collection'),\n\n    /**\n     * @const\n     * @type {string}\n     */\n    FUNCTION = 'function',\n\n    SAFE_CONTEXT_PROPERTIES = ['replayState', 'coords'];\n\n/**\n * Creates a context object to be used with `http-request.command` extension.\n *\n * @function createItemContext\n *\n * @param {Object} payload -\n * @param {Item} payload.item -\n * @param {Object} [payload.coords] -\n * @param {Object} [defaults] -\n * @param {Object} [defaults.replayState] -\n * @param {Object} [defaults.coords] -\n *\n * @returns {ItemContext}\n */\nmodule.exports = function (payload, defaults) {\n    // extract properties from defaults that can/should be reused in new context\n    var context = defaults ? _.pick(defaults, SAFE_CONTEXT_PROPERTIES) : {};\n\n    // set cursor to context\n    !context.coords && (context.coords = payload.coords);\n\n    // save original item for reference\n    context.originalItem = payload.item;\n\n    // we clone item from the payload, so that we can make any changes we need there, without mutating the\n    // collection\n    context.item = new sdk.Item(payload.item.toJSON());\n\n    // get a reference to the Auth instance from the item, so changes are synced back\n    context.auth = context.originalItem.getAuth();\n\n    // Make sure run is not errored out if older version of collection SDK is used.\n    // @todo remove this safety check in the next release\n    if (typeof context.originalItem.getProtocolProfileBehaviorResolved === FUNCTION) {\n        // get protocolProfileBehavior for the item, also inherited from parent\n        context.protocolProfileBehavior = context.originalItem.getProtocolProfileBehaviorResolved();\n    }\n    else {\n        // get protocolProfileBehavior for the item\n        context.protocolProfileBehavior = context.originalItem.protocolProfileBehavior;\n    }\n\n    /**\n     * @typedef {Object} ItemContext\n     * @property {Object} coords - current cursor\n     * @property {Item} originalItem - reference to the item in the collection\n     * @property {Item} item -  Holds a copy of the item given in the payload, so that it can be manipulated\n     * as necessary\n     * @property {RequestAuthBase|undefined} auth - If present, is the instance of Auth in the collection, which\n     * is changed as necessary using intermediate requests, etc.\n     * @property {ReplayState} replayState - has context on number of replays(if any) for this request\n     */\n    return context;\n};\n"],"mappings":"AAAA,IAAIA,CAAC,GAAGC,OAAO,CAAC,QAAQ,CAAC;EACrBC,GAAG,GAAGD,OAAO,CAAC,oBAAoB,CAAC;EAEnC;AACJ;AACA;AACA;EACIE,QAAQ,GAAG,UAAU;EAErBC,uBAAuB,GAAG,CAAC,aAAa,EAAE,QAAQ,CAAC;;AAEvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,MAAM,CAACC,OAAO,GAAG,UAAUC,OAAO,EAAEC,QAAQ,EAAE;EAC1C;EACA,IAAIC,OAAO,GAAGD,QAAQ,GAAGR,CAAC,CAACU,IAAI,CAACF,QAAQ,EAAEJ,uBAAuB,CAAC,GAAG,CAAC,CAAC;;EAEvE;EACA,CAACK,OAAO,CAACE,MAAM,KAAKF,OAAO,CAACE,MAAM,GAAGJ,OAAO,CAACI,MAAM,CAAC;;EAEpD;EACAF,OAAO,CAACG,YAAY,GAAGL,OAAO,CAACM,IAAI;;EAEnC;EACA;EACAJ,OAAO,CAACI,IAAI,GAAG,IAAIX,GAAG,CAACY,IAAI,CAACP,OAAO,CAACM,IAAI,CAACE,MAAM,EAAE,CAAC;;EAElD;EACAN,OAAO,CAACO,IAAI,GAAGP,OAAO,CAACG,YAAY,CAACK,OAAO,EAAE;;EAE7C;EACA;EACA,IAAI,OAAOR,OAAO,CAACG,YAAY,CAACM,kCAAkC,KAAKf,QAAQ,EAAE;IAC7E;IACAM,OAAO,CAACU,uBAAuB,GAAGV,OAAO,CAACG,YAAY,CAACM,kCAAkC,EAAE;EAC/F,CAAC,MACI;IACD;IACAT,OAAO,CAACU,uBAAuB,GAAGV,OAAO,CAACG,YAAY,CAACO,uBAAuB;EAClF;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,OAAOV,OAAO;AAClB,CAAC"},"metadata":{},"sourceType":"script"}