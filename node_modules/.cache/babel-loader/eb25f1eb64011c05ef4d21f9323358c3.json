{"ast":null,"code":"var _ = require('lodash'),\n  AuthLoader = require('../authorizer/index').AuthLoader,\n  createAuthInterface = require('../authorizer/auth-interface'),\n  DOT_AUTH = '.auth';\nmodule.exports = [\n// Post authorization.\nfunction (context, run, done) {\n  // if no response is provided, there's nothing to do, and probably means that the request errored out\n  // let the actual request command handle whatever needs to be done.\n  if (!context.response) {\n    return done();\n  }\n\n  // bail out if there is no auth\n  if (!(context.auth && context.auth.type)) {\n    return done();\n  }\n  var auth = context.auth,\n    originalAuth = context.originalItem.getAuth(),\n    originalAuthParams = originalAuth && originalAuth.parameters(),\n    authHandler = AuthLoader.getHandler(auth.type),\n    authInterface = createAuthInterface(auth);\n\n  // bail out if there is no matching auth handler for the type\n  if (!authHandler) {\n    run.triggers.console(context.coords, 'warn', 'runtime: could not find a handler for auth: ' + auth.type);\n    return done();\n  }\n\n  // invoke `post` on the Auth\n  authHandler.post(authInterface, context.response, function (err, success) {\n    // sync all auth system parameters to the original auth\n    originalAuthParams && auth.parameters().each(function (param) {\n      param && param.system && originalAuthParams.upsert({\n        key: param.key,\n        value: param.value,\n        system: true\n      });\n    });\n\n    // sync auth state back to item request\n    _.set(context, 'item.request.auth', auth);\n\n    // there was an error in auth post hook\n    // warn the user but don't bubble it up\n    if (err) {\n      run.triggers.console(context.coords, 'warn', 'runtime~' + auth.type + '.auth: there was an error validating auth: ' + (err.message || err), err);\n      return done();\n    }\n\n    // auth was verified\n    if (success) {\n      return done();\n    }\n\n    // request a replay of request\n    done(null, {\n      replay: true,\n      helper: auth.type + DOT_AUTH\n    });\n  });\n}];","map":{"version":3,"names":["_","require","AuthLoader","createAuthInterface","DOT_AUTH","module","exports","context","run","done","response","auth","type","originalAuth","originalItem","getAuth","originalAuthParams","parameters","authHandler","getHandler","authInterface","triggers","console","coords","post","err","success","each","param","system","upsert","key","value","set","message","replay","helper"],"sources":["/Users/Qusai.Qishta/node_modules/postman-runtime/lib/runner/request-helpers-postsend.js"],"sourcesContent":["var _ = require('lodash'),\n\n    AuthLoader = require('../authorizer/index').AuthLoader,\n    createAuthInterface = require('../authorizer/auth-interface'),\n\n    DOT_AUTH = '.auth';\n\nmodule.exports = [\n    // Post authorization.\n    function (context, run, done) {\n        // if no response is provided, there's nothing to do, and probably means that the request errored out\n        // let the actual request command handle whatever needs to be done.\n        if (!context.response) { return done(); }\n\n        // bail out if there is no auth\n        if (!(context.auth && context.auth.type)) { return done(); }\n\n        var auth = context.auth,\n            originalAuth = context.originalItem.getAuth(),\n            originalAuthParams = originalAuth && originalAuth.parameters(),\n            authHandler = AuthLoader.getHandler(auth.type),\n            authInterface = createAuthInterface(auth);\n\n        // bail out if there is no matching auth handler for the type\n        if (!authHandler) {\n            run.triggers.console(context.coords, 'warn', 'runtime: could not find a handler for auth: ' + auth.type);\n\n            return done();\n        }\n\n        // invoke `post` on the Auth\n        authHandler.post(authInterface, context.response, function (err, success) {\n            // sync all auth system parameters to the original auth\n            originalAuthParams && auth.parameters().each(function (param) {\n                param && param.system &&\n                    originalAuthParams.upsert({ key: param.key, value: param.value, system: true });\n            });\n\n            // sync auth state back to item request\n            _.set(context, 'item.request.auth', auth);\n\n            // there was an error in auth post hook\n            // warn the user but don't bubble it up\n            if (err) {\n                run.triggers.console(context.coords,\n                    'warn',\n                    'runtime~' + auth.type + '.auth: there was an error validating auth: ' + (err.message || err),\n                    err);\n\n                return done();\n            }\n\n            // auth was verified\n            if (success) { return done(); }\n\n            // request a replay of request\n            done(null, { replay: true, helper: auth.type + DOT_AUTH });\n        });\n    }\n];\n"],"mappings":"AAAA,IAAIA,CAAC,GAAGC,OAAO,CAAC,QAAQ,CAAC;EAErBC,UAAU,GAAGD,OAAO,CAAC,qBAAqB,CAAC,CAACC,UAAU;EACtDC,mBAAmB,GAAGF,OAAO,CAAC,8BAA8B,CAAC;EAE7DG,QAAQ,GAAG,OAAO;AAEtBC,MAAM,CAACC,OAAO,GAAG;AACb;AACA,UAAUC,OAAO,EAAEC,GAAG,EAAEC,IAAI,EAAE;EAC1B;EACA;EACA,IAAI,CAACF,OAAO,CAACG,QAAQ,EAAE;IAAE,OAAOD,IAAI,EAAE;EAAE;;EAExC;EACA,IAAI,EAAEF,OAAO,CAACI,IAAI,IAAIJ,OAAO,CAACI,IAAI,CAACC,IAAI,CAAC,EAAE;IAAE,OAAOH,IAAI,EAAE;EAAE;EAE3D,IAAIE,IAAI,GAAGJ,OAAO,CAACI,IAAI;IACnBE,YAAY,GAAGN,OAAO,CAACO,YAAY,CAACC,OAAO,EAAE;IAC7CC,kBAAkB,GAAGH,YAAY,IAAIA,YAAY,CAACI,UAAU,EAAE;IAC9DC,WAAW,GAAGhB,UAAU,CAACiB,UAAU,CAACR,IAAI,CAACC,IAAI,CAAC;IAC9CQ,aAAa,GAAGjB,mBAAmB,CAACQ,IAAI,CAAC;;EAE7C;EACA,IAAI,CAACO,WAAW,EAAE;IACdV,GAAG,CAACa,QAAQ,CAACC,OAAO,CAACf,OAAO,CAACgB,MAAM,EAAE,MAAM,EAAE,8CAA8C,GAAGZ,IAAI,CAACC,IAAI,CAAC;IAExG,OAAOH,IAAI,EAAE;EACjB;;EAEA;EACAS,WAAW,CAACM,IAAI,CAACJ,aAAa,EAAEb,OAAO,CAACG,QAAQ,EAAE,UAAUe,GAAG,EAAEC,OAAO,EAAE;IACtE;IACAV,kBAAkB,IAAIL,IAAI,CAACM,UAAU,EAAE,CAACU,IAAI,CAAC,UAAUC,KAAK,EAAE;MAC1DA,KAAK,IAAIA,KAAK,CAACC,MAAM,IACjBb,kBAAkB,CAACc,MAAM,CAAC;QAAEC,GAAG,EAAEH,KAAK,CAACG,GAAG;QAAEC,KAAK,EAAEJ,KAAK,CAACI,KAAK;QAAEH,MAAM,EAAE;MAAK,CAAC,CAAC;IACvF,CAAC,CAAC;;IAEF;IACA7B,CAAC,CAACiC,GAAG,CAAC1B,OAAO,EAAE,mBAAmB,EAAEI,IAAI,CAAC;;IAEzC;IACA;IACA,IAAIc,GAAG,EAAE;MACLjB,GAAG,CAACa,QAAQ,CAACC,OAAO,CAACf,OAAO,CAACgB,MAAM,EAC/B,MAAM,EACN,UAAU,GAAGZ,IAAI,CAACC,IAAI,GAAG,6CAA6C,IAAIa,GAAG,CAACS,OAAO,IAAIT,GAAG,CAAC,EAC7FA,GAAG,CAAC;MAER,OAAOhB,IAAI,EAAE;IACjB;;IAEA;IACA,IAAIiB,OAAO,EAAE;MAAE,OAAOjB,IAAI,EAAE;IAAE;;IAE9B;IACAA,IAAI,CAAC,IAAI,EAAE;MAAE0B,MAAM,EAAE,IAAI;MAAEC,MAAM,EAAEzB,IAAI,CAACC,IAAI,GAAGR;IAAS,CAAC,CAAC;EAC9D,CAAC,CAAC;AACN,CAAC,CACJ"},"metadata":{},"sourceType":"script"}